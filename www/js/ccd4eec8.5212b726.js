(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ccd4eec8"],{"097d":function(t,e,i){"use strict";var s=i("5ca1"),n=i("8378"),o=i("7726"),a=i("ebd6"),r=i("bcaa");s(s.P+s.R,"Promise",{finally:function(t){var e=a(this,n.Promise||o.Promise),i="function"==typeof t;return this.then(i?function(i){return r(e,t()).then(function(){return i})}:t,i?function(i){return r(e,t()).then(function(){throw i})}:t)}})},f241:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-layout",{attrs:{view:"lHh Lpr lFf"}},[i("q-header",[i("q-bar",{staticClass:"bg-deep-orange text-white"},[i("q-icon",{attrs:{name:t.statusBarInfo.machineStatusIcon}}),i("div",[t._v(t._s(t.machineStatusText))]),i("q-space"),i("div",[t._v(t._s(t.statusBarInfo.breweryName))]),i("q-space"),i("div",[i("q-chip",{attrs:{icon:t.wifiIcon,label:t.wifiStatus.staSsid,"text-color":"white",color:"deep-orange"}}),t.wifiStatus.staIp?i("q-tooltip",[t._v(t._s(t.wifiStatus.staIp))]):t._e()],1),i("div",[t._v(t._s(t.statusBarInfo.realDate))]),i("div",[t._v(t._s(t.statusBarInfo.realTime))]),i("q-btn",{attrs:{dense:"",flat:"",icon:"mdi-wrench"},on:{click:t.handleSettingsBtn}})],1)],1),i("q-drawer",{attrs:{bordered:"","content-class":"bg-grey-2"},model:{value:t.leftDrawerOpen,callback:function(e){t.leftDrawerOpen=e},expression:"leftDrawerOpen"}},[i("q-list",[i("q-item-label",{attrs:{header:""}},[t._v("设置选项")]),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-beach"}})],1),i("q-item-section",[i("q-item-label",[t._v("酒厂名称")]),i("q-item-label",[i("q-input",{attrs:{disable:t.inputDisabled,outlined:"",dense:""},model:{value:t.optionBreweryName,callback:function(e){t.optionBreweryName=e},expression:"optionBreweryName"}})],1)],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-account-card-details"}})],1),i("q-item-section",[i("q-item-label",[t._v("无线SSID")]),i("q-item-label",[i("q-input",{attrs:{disable:t.inputDisabled,outlined:"",dense:""},model:{value:t.settings.apSsid,callback:function(e){t.$set(t.settings,"apSsid",e)},expression:"settings.apSsid"}})],1)],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-wifi-star"}})],1),i("q-item-section",[i("q-item-label",[t._v("WiFi热点")]),i("q-item-label",[i("q-select",{attrs:{disable:t.inputDisabled,outlined:"",options:t.settings.wifiList,dense:"","options-dense":""},model:{value:t.settings.wifi.ssid,callback:function(e){t.$set(t.settings.wifi,"ssid",e)},expression:"settings.wifi.ssid"}})],1),i("q-item-label",[i("q-input",{attrs:{disable:t.inputDisabled,outlined:"",type:t.isPwd?"password":"text",dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"mdi-eye-off-outline":"mdi-eye-outline"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.settings.wifi.pass,callback:function(e){t.$set(t.settings.wifi,"pass",e)},expression:"settings.wifi.pass"}})],1)],1),i("q-item-section",{attrs:{avatar:""}},[i("q-item-label",[t._v(" ")]),i("q-item-label",[i("q-btn",{attrs:{disable:t.inputDisabled,round:"",dense:"",color:"deep-orange",icon:"mdi-refresh"},on:{click:t.handleWifiRefreshBtn}},[i("q-tooltip",{attrs:{anchor:"top middle",self:"bottom middle"}},[t._v("\n                  刷新WiFi列表\n                ")])],1)],1),i("q-item-label",[i("q-btn",{attrs:{disable:t.inputDisabled,round:"",dense:"",color:"deep-orange",icon:"mdi-rss"},on:{click:t.handleWifiConnectBtn}},[i("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                  连接WiFi热点\n                ")])],1)],1)],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-oil-temperature"}})],1),i("q-item-section",[i("q-item-label",[t._v("温度传感器")]),i("q-item-label",[i("q-select",{attrs:{disable:t.inputDisabled,outlined:"",dense:"","options-dense":"",options:t.settings.tempSensorList,hint:t.testWortTemp?"麦芽汁温度："+t.testWortTemp+"℃":"麦芽汁温度传感器"},model:{value:t.settings.wortSensorDev,callback:function(e){t.$set(t.settings,"wortSensorDev",e)},expression:"settings.wortSensorDev"}})],1),i("q-item-label",[i("q-select",{attrs:{disable:t.inputDisabled,dense:"","options-dense":"",outlined:"",options:t.settings.tempSensorList,hint:t.testChamberTemp?"发酵箱温度："+t.testChamberTemp+"℃":"发酵箱温度传感器"},model:{value:t.settings.chamberSensorDev,callback:function(e){t.$set(t.settings,"chamberSensorDev",e)},expression:"settings.chamberSensorDev"}})],1),i("q-item-label",{staticClass:"flex justify-end"},[i("q-btn",{attrs:{disable:t.inputDisabled,dense:"",round:"",color:"deep-orange",icon:"mdi-thermometer-lines"},on:{click:t.handleTempTestBtn}},[i("q-tooltip",{attrs:{anchor:"center left",self:"center right"}},[t._v("\n                  测试温度传感器\n                ")])],1)],1)],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-engine"}})],1),i("q-item-section",[i("q-item-label",[t._v("制冷加热测试")]),i("q-item-label",[i("div",[i("q-toggle",{staticClass:"q-mr-md",attrs:{disable:t.inputDisabled,icon:"mdi-snowflake",label:"制冷","left-label":""},model:{value:t.testCoolerIsOn,callback:function(e){t.testCoolerIsOn=e},expression:"testCoolerIsOn"}}),i("q-toggle",{attrs:{disable:t.inputDisabled,color:"pink",icon:"mdi-fire",label:"加热","left-label":""},model:{value:t.testHeaterIsOn,callback:function(e){t.testHeaterIsOn=e},expression:"testHeaterIsOn"}})],1)])],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"mdi-cloud-upload-outline"}})],1),i("q-item-section",[i("q-item-label",[t._v("开启FTP服务")]),i("q-item-label",{attrs:{caption:""}},[t._v("用于程序源文件的升级")]),t.wifiStatus.apIp?i("q-item-label",{attrs:{caption:""}},[t._v(t._s("ftp://"+t.wifiStatus.apIp+":21"))]):t._e(),t.wifiStatus.staIp?i("q-item-label",{attrs:{caption:""}},[t._v(t._s("ftp://"+t.wifiStatus.staIp+":21"))]):t._e()],1),i("q-item-section",{attrs:{avatar:""}},[i("q-btn",{attrs:{disable:t.inputDisabled,round:"",dense:"",color:"deep-orange",icon:"mdi-upload-network"},on:{click:t.handleFtpConnectBtn}},[i("q-tooltip",{attrs:{anchor:"bottom middle",self:"top middle"}},[t._v("\n                开启FTP服务\n              ")])],1)],1)],1),i("q-separator",{attrs:{spaced:""}}),i("q-item",{staticClass:"q-mt-md"},[i("q-item-section",{staticClass:"q-mr-sm"},[i("q-btn",{attrs:{disable:t.rebootBtnIsDisabled,glossy:"",unelevated:"",color:"deep-orange",icon:"mdi-restart",label:"重 启",size:"md"},on:{click:t.handleRebootBtn}},[i("q-tooltip",[t._v("\n                重启设备使设置生效\n              ")])],1)],1),i("q-item-section",[i("q-btn",{attrs:{disable:t.inputDisabled,glossy:"",unelevated:"",color:"deep-orange",icon:"mdi-content-save-all",label:"保 存",size:"md"},on:{click:t.handleSaveSettingsBtn}},[i("q-tooltip",[t._v("\n                保存设置选项\n              ")])],1)],1)],1)],1)],1),i("q-page-container",[i("router-view")],1)],1)},n=[],o=(i("551c"),i("06db"),i("097d"),i("0967"),i("2b0e"),{name:"MyLayout",created:function(){this.$root.$on("statusBarInfo",this.updateStatusBar),setTimeout(this.loadSettings,16e3)},beforeDestroy:function(){this.$root.$off("statusBarInfo",this.updateStatusBar)},methods:{testActuator:function(t,e){this.$axios.post("/actuactor",{element:t,action:e}).then(function(t){console.log(t)}).catch(function(t){console.log(t)})},updateStatusBar:function(t){this.statusBarInfo=t},loadSettings:function(){var t=this;this.$axios.get("/settings").then(function(e){t.settings=e.data,t.optionBreweryName=t.settings.breweryName}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-close-circle-outline",message:"Error: 无法从后台获取设置选项数据!"})})},handleSettingsBtn:function(){this.leftDrawerOpen||this.loadSettings(),this.leftDrawerOpen=!this.leftDrawerOpen,this.testWortTemp=null,this.testChamberTemp=null},handleWifiRefreshBtn:function(){var t=this;this.$axios.get("/wifi").then(function(e){t.settings.wifiList=e.data.wifiList}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-wifi-strength-alert-outline",message:"Error: 无法刷新WiFi热点列表!"})})},updateWifiStatus:function(){var t=this;this.$axios.get("/ip").then(function(e){t.wifiStatus=e.data}).catch(function(t){console.log(t)}).finally(function(){t.wifiStatus.staIp?t.statusBarInfo.wifiIsConnected=!0:t.statusBarInfo.wifiIsConnected=!1})},handleWifiConnectBtn:function(){var t=this;this.$axios.post("/wifi",this.settings.wifi).then(function(e){console.log(e),t.$q.notify({color:"info",icon:"mdi-wifi",message:"已成功连接WiFi热点“".concat(t.settings.wifi.ssid,"”!")})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-wifi-off",message:"Error: 无法连接WiFi热点“".concat(t.settings.wifi.ssid,"”!")})}).finally(function(){t.updateWifiStatus()})},handleTempTestBtn:function(){var t=this;this.$axios.post("/tempsensors",{wortSensorDev:this.settings.wortSensorDev,chamberSensorDev:this.settings.chamberSensorDev}).then(function(e){t.testWortTemp=e.data.wortTemp,t.testChamberTemp=e.data.chamberTemp}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-close-circle-outline",message:"Error: 无法获取温度传感器数据!"})})},handleFtpConnectBtn:function(){var t=this;this.$axios.get("/ftp").then(function(e){t.$q.notify({color:"info",icon:"mdi-checkbox-marked-circle-outline",message:"FTP服务已经开启!"})}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-close-circle-outline",message:"Error: 无法开启FTP服务!"})})},handleSaveSettingsBtn:function(){var t=this;this.$axios.post("/settings",{breweryName:this.optionBreweryName,wortSensorDev:this.settings.wortSensorDev,chamberSensorDev:this.settings.chamberSensorDev,apSsid:this.settings.apSsid,wifi:this.settings.wifi}).then(function(e){t.$q.notify({color:"info",icon:"mdi-checkbox-marked-circle-outline",message:"已成功保存设置选项! 请重启设备!"}),t.rebootBtnIsDisabled=!1}).catch(function(e){console.log(e),t.$q.notify({color:"negative",icon:"mdi-close-circle-outline",message:"Error: 保存设置选项失败!"})})},handleRebootBtn:function(){this.rebootBtnIsDisabled=!0,this.confirmReboot()},confirmReboot:function(){var t=this;this.$q.dialog({title:"确认重启设备",message:"是否确认要重启设备的主控板？",ok:{push:!0},cancel:{push:!0,color:"negative"},persistent:!0}).onOk(function(){t.$axios("/reboot").then(function(e){t.$q.notify({color:"info",icon:"mdi-restore",message:"正在重启设备，请稍候..."}),t.rebootBtnIsDisabled=!0}).catch(function(e){console.log(e),t.rebootBtnIsDisabled=!1})}).onCancel(function(){t.rebootBtnIsDisabled=!1})}},watch:{wifiIsConnected:function(){this.updateWifiStatus()},testCoolerIsOn:function(){this.testActuator("cooler",this.testCoolerIsOn)},testHeaterIsOn:function(){this.testActuator("heater",this.testHeaterIsOn)}},computed:{wifiIcon:function(){return this.statusBarInfo.wifiIsConnected?"mdi-wifi":"mdi-wifi-off"},machineStatusText:function(){return"running"===this.statusBarInfo.machineStatus?"正在发酵":"done"===this.statusBarInfo.machineStatus?"发酵完成":"准备就绪"},inputDisabled:function(){return"running"===this.statusBarInfo.machineStatus},wifiIsConnected:function(){return this.statusBarInfo.wifiIsConnected}},data:function(){return{statusBarInfo:{machineStatus:null,machineStatusIcon:null,breweryName:"",wifiIsConnected:!1,realDate:"0000/00/00",realTime:"00:00"},wifiStatus:{apIp:null,staIp:null,staSsid:null},optionBreweryName:"",leftDrawerOpen:!1,settings:{apSsid:"",wifi:{ssid:"",pass:""},wifiList:[],wortSensorDev:{value:null,label:""},chamberSensorDev:{value:null,label:""},tempSensorList:[{value:null,label:""},{value:null,label:""}]},isPwd:!0,testWortTemp:null,testChamberTemp:null,testCoolerIsOn:!1,testHeaterIsOn:!1,rebootBtnIsDisabled:!0}}}),a=o,r=i("2877"),l=Object(r["a"])(a,s,n,!1,null,null,null);e["default"]=l.exports}}]);